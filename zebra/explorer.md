# NightHawk Explorer support in Zebra report.

Repo:
https://github.com/nighthawk-apps/zcash-explorer


Official live explorer:
https://zcashblockexplorer.com/


## Support needed


| API METHOD                  | Supported in zebra | Notes                                                                                                                                                                                                               | Docs                                                                                                                                                                         | Used in                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| getblockhashes              | NO.                | As it is used in different places, with different arguments, it need all the fields and options.<br>(noOrphans is always true.)                                                                                                                    | [Zcash](https://zcash.github.io/rpc/getblockhashes.html)                                                                                                                     | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/blocks/block_warmer.ex#L19) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/transactions/transaction_cache.ex#L19) - [3](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L54) - [4](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L89)                                                                                                                              |
| getblock                    | YES, partially.    | At least the following fields are needed as part of `verbose=2` mode:<br>`height`<br>`size`<br>`hash`<br>`time`<br>`tx.vout`<br>We'll need to add `time`, `size`, and `tx.vout` to the existing database indexes, and `size` to the non-finalized state indexes.<br>                                                                                                  | [Zcash](https://zcash.github.io/rpc/getblock.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_block)                                 | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/blocks/block_warmer.ex#L24) [calls](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/views/block_view.ex#L72) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/transactions/transaction_cache.ex#L24) - [3](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L5) - [4](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L12) - [5](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/search_controller.ex#L14) |
| getrawmempool               | YES, partially.    | We support this call, however the explorer use the verbose mode that zebra do not support yet.<br>We'd need to track when transactions entered the mempool:<br>`height`<br>`time`                                                                                                                     | [Zcash](https://zcash.github.io/rpc/getrawmempool.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_raw_mempool)                      | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/mempool/mempool_warmer.ex#L14) [called by](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/live/raw_mempool_live.ex#L19)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| getinfo                     | YES.    | Zebra fully implement the arguments and results of this call. | [Zcash](https://zcash.github.io/rpc/getinfo.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_info)                                   | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/metrics/info_warmer.ex#L14)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| getmempoolinfo              | NO.                | No arguments.<br>We'll need to estimate mempool memory usage.                                                                                                                                                                                                       | [Zcash](https://zcash.github.io/rpc/getmempoolinfo.html)                                                                                                                     | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/metrics/mempool_info_warmer.ex#L14)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| getblockchaininfo           | YES, partially.    | At least the following fields are needed:<br>`commitments`<br>`difficulty`<br>`size_on_disk`<br>`valuePools`<br><br>These fields are missing in the zebra implementation.<br>We'll need to add a new database entry for the total block size.<br>In the explorer this information is appended to an `info` array.                                                                                                                                                    | [Zcash](https://zcash.github.io/rpc/getblockchaininfo.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_blockchain_info)              | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/metrics/metrics_warmer.ex#L14)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| getnetworksolps             | YES.               | Appends the data from this call to the `info` array.<br>Zebra fully implement the arguments and results of this call.                                                                                               | [Zcash](https://zcash.github.io/rpc/getnetworksolps.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.GetBlockTemplateRpc.html#tymethod.get_network_sol_ps) | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/metrics/networksolps_warmer.ex#L14)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| getpeerinfo                 | YES, partially.    | The explorer takes all the fields and add them to a `nodes`  array. The following extra fields are needed in Zebra:<br>`subver`<br>`synced_blocks`                                       | [Zcash](https://zcash.github.io/rpc/getpeerinfo.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.GetBlockTemplateRpc.html#tymethod.get_peer_info)          | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/nodes/nodes_warmer.ex#L14) [called by](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/live/nodes_live.ex#L17)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| getrawtransaction           | YES, partially.    | The `blockhash` argument is not used in the explorer which is good but at least the following extra fields are needed in the response:<br>`txid`<br>`time` (from block header)<br>`size`<br>`vout`<br>tx type: many transparent and shielded fields<br>We'll need to add `tx.size` to the existing database and non-finalized state indexes.               | [Zcash](https://zcash.github.io/rpc/getrawtransaction.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_raw_transaction)              | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer/transactions/transaction_cache.ex#L30) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/search_controller.ex#L15) - [3](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/transaction_controller.ex#L5) [called by](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/live/recent_transactions_live.ex#L19) - [4](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/transaction_controller.ex#L12)                                                                                                     |
| getaddressbalance           | YES, partially.    | Zebra needs to implement the `received` field.<br>This needs to be stored for each address in the database, as a `u128`.                                                                                  | [Zcash](https://zcash.github.io/rpc/getaddressbalance.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/trait.Rpc.html#tymethod.get_address_balance)              | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/address_controller.ex#L28) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/address_controller.ex#L72) [calls](https://github.com/nighthawk-apps/zcashex/blob/main/lib/zcashex.ex#L128) [called by](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/templates/address/address.html.eex#L45)                                                                                                                                                                                                                                                                                                                                                                     |
| getaddressdeltas            | NO.                | We need to implement almost fully.<br>This might need a new index in the database.                                                                                                                                                                                  | [Zcash](https://zcash.github.io/rpc/getaddressdeltas.html)                                                                                                                   | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/address_controller.ex#L29) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/address_controller.ex#L73)                                                                                                                                                                                                                                                                                                                                                                     |
| z_listunifiedreceivers      | MINING.                | Not implemented but I'll implement as part of the mining project: https://github.com/ZcashFoundation/zebra/issues/6030                                                                                         | [Zcash](https://zcash.github.io/rpc/z_listunifiedreceivers.html)                                                                                                             | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/address_controller.ex#L96)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| getblockheader              | NO.                | Need to fully implement in verbose mode.                                                                                                                                                                            | [Zcash](https://zcash.github.io/rpc/getblockheader.html)                                                                                                                     | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L58) - [2](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/block_controller.ex#L93)                                                                                                                                                                                                                                                                                                                                                                         |
| sendrawtransaction          | YES.               | Fully implemengted.                                                                                                                                                                                                 | [Zcash](https://zcash.github.io/rpc/sendrawtransaction.html) - [Zebra](https://doc.zebra.zfnd.org/zebra_rpc/methods/struct.RpcImpl.html#method.send_raw_transaction)         | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/page_controller.ex#L18)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| z_validatepaymentdisclosure | NO.                | Need to be fully implemented. Specification still in draft.                                                                                                                           | [Zcash](https://zcash.github.io/rpc/z_validatepaymentdisclosure.html) [docs](https://github.com/zcash/zcash/blob/master/doc/payment-disclosure.md) [draft ZIP](https://github.com/zcash/zips/pull/119)                                                                                                       | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/page_controller.ex#L49)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| validateaddress             | YES.                | Already implemented as part of the mining work.                                                                               | [Zcash](https://zcash.github.io/rpc/validateaddress.html)                                                                                                                    | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/search_controller.ex#L16)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| z_validateaddress           | MINING.                | Will be implemented as part of the mining work: https://github.com/ZcashFoundation/zebra/issues/6083                                                                                                                                                                                           | [Zcash](https://zcash.github.io/rpc/z_validateaddress.html)                                                                                                                  | [1](https://github.com/nighthawk-apps/zcash-explorer/blob/main/lib/zcash_explorer_web/controllers/search_controller.ex#L17)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |


## Features


- Be able to run the explorer with a zebra backend replacement. Everything should work.
- Write a document explaining how to do it.

## Scope

### Installation

1 week.

### Tecnical details to be resolved by the Zebra team (rust feature, location of the code, etc).

1 week.

### RPC methods development and testing

Estimating 1 week per call including tests, if we take away the ones that we have already fully implemented and the ones that will be implemented as part of mining and before this project start, we have 11 calls to implement or modify.

11 weeks.

### Write document

1 week

### Total : 14 weeks or 3-4 months of work


## Advantages and Disadvantages

| Pros                                                                                                                          | Cons                                                                                                                         |
| ----------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| It is aligned with the idea of getting more users into zebra. If we can switch the official explorer implementation to zebra. | Almost all the rpc methods we already have, need changes to with with the explorer. In addition, new rpc methods are needed. |
| It follow pretty much what we were doing, last 2 zebra projects were rpc related, this is also in the same line.              | I am having a hard time trying to install the explorer in my local machine.                                                  |
| Can be started right away with small planning.                                                                                | It is not new, in the way zcash already do it. Also people might be bored of rpc methods.                                    |
| Indirectly can get more users are more API calls are exposed.                                                                 |                                                                                                                              |
| It should be easy to test.                                                                                                    |                                                                                                                              |

